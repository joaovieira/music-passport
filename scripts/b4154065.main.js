(function(){window.musicPassport={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";return this.user=new musicPassport.Models.Profile,this.passport=new musicPassport.Models.Passport,this.appView=new musicPassport.Views.App({model:this.user}),this.router=new musicPassport.Routers.AppRouter,Backbone.history.start()}},$(function(){"use strict";return musicPassport.init()}),window.Evt=new Evrythng({evrythngApiKey:"EyvifRsWvxEh4prtcQ6LQtSHAs9AF8ce2iuxomMFbCMkaXUvpxnvOUOAH6fDePuug66HRIGGiFcDQzF7",evrythngAppId:"52d0185a55872c9a6d7b1616",facebookAppId:"1449050295309307",jQuery:jQuery}),$(document).on("fbStatusChange",function(a,b){return"connected"===b.status?FB.api("/me",function(a){return b={access:{token:b.authResponse.accessToken}},Evt.request({url:"/auth/facebook",data:b,method:"post"},function(b){var c;return b.evrythngApiKey?(musicPassport.user.set(a),musicPassport.user.set("userApiKey",b.evrythngApiKey),c=musicPassport.passport.get("thngid"),musicPassport.router.navigate(""+c+"/home",{trigger:!0})):void 0})}):(musicPassport.user.set(musicPassport.user.defaults),musicPassport.router.navigate(""+musicPassport.passport.get("thngid"),{trigger:!0}))})}).call(this),window.JST||(window.JST={}),window.JST["app/scripts/templates/app"]=function(a){var b=function(a){"undefined"==typeof a&&null==a&&(a="");var b=new String(a);return b.ecoSafe=!0,b};return function(){var a=[],c=this,d=function(b){"undefined"!=typeof b&&null!=b&&a.push(b.ecoSafe?b:c.escape(b))};return function(){d(b('<!-- navigation -->\n<nav id="navigation" class="navbar navbar-default navbar-fixed-top" role="navigation">\n	<!-- navigation dependent of login -->\n</nav>\n\n\n<!-- content -->\n<div class="jumbotron panel-holder">\n  <div id="panel-carousel" class="owl-carousel">\n\n  </div>\n</div>'))}.call(this),a.join("")}.call(function(){var c,d={escape:function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},safe:b};for(c in a)d[c]=a[c];return d}())},window.JST||(window.JST={}),window.JST["app/scripts/templates/home"]=function(a){var b=function(a){"undefined"==typeof a&&null==a&&(a="");var b=new String(a);return b.ecoSafe=!0,b};return function(){var a=[],c=this,d=function(b){"undefined"!=typeof b&&null!=b&&a.push(b.ecoSafe?b:c.escape(b))};return function(){this.exists?this.own?d(b('\n	<div id="viewing" class="panel">\n		<p>You\'re currently watching</p>\n		<a href="#" class="checkin">Check in concert!</a>\n	</div>\n	<div id="playing" class="panel">\n		<p>Also playing</p>\n		<p>Your next show in 2 hours</p>\n		<a href="#" class="passport">Check my concerts</a>\n	</div>\n')):(d(b("\n	")),this["new"]?d(b('\n		<div class="panel">\n			<h2>Congratulations! You\'ve got a new fancy accessory</h2>\n			<p>This bracelet is not registered. Claim it and start using your passport</p>\n			<p>\n				<a href="#" class="btn btn-primary btn-large btn-claim">Claim my bracelet</a>\n			</p>\n		</div>\n	')):d(b('\n		<div class="panel">\n			<h2>Getting new friends?</h2>\n			<p>This isn\'t your bracelet. Please scan yours to use your passport</p>\n		</div>\n	')),d(b("\n"))):d(b('\n	<div class="panel">\n		<h2>Oops! This bracelet does\'t exist</h2>\n		<p>Please scan a valid bracelet and claim it to start using your passport</p>\n	</div>\n')),d(b('\n<div id="lineup" class="panel">\n	<p>View lineup</p>\n	<a href="#" class="lineup">View</a>\n</div>'))}.call(this),a.join("")}.call(function(){var c,d={escape:function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},safe:b};for(c in a)d[c]=a[c];return d}())},window.JST||(window.JST={}),window.JST["app/scripts/templates/login"]=function(a){var b=function(a){"undefined"==typeof a&&null==a&&(a="");var b=new String(a);return b.ecoSafe=!0,b};return function(){var a=[],c=this,d=function(b){"undefined"!=typeof b&&null!=b&&a.push(b.ecoSafe?b:c.escape(b))};return function(){d(b('<div class="navbar-header">\n\n	')),this.id?(d(b('\n		<button type="button" id="menu" class="navbar-toggle avatar" data-toggle="collapse" data-target="#navbar-collapse-1">\n    	')),d(this.name),d(b('\n    	<img src="https://graph.facebook.com/')),d(this.id),d(b('/picture?width=32&height=32" width="28" height="28"/>\n    	<span class="caret"></span>\n		</button>\n	'))):d(b('\n		<button type="button" class="navbar-toggle login" data-toggle="collapse" data-target="#navbar-collapse-1">Login</button>\n	')),d(b('\n\n	<a class="navbar-brand brand-logo" href="#">Music Passport</a>\n</div>\n\n<div class="collapse navbar-collapse" id="navbar-collapse-1">\n	')),this.id&&d(b('\n		<ul id="login" class="nav navbar-nav">\n  			<li><a href="#" id="lineup">My Passport</a></li>\n  			<li><a href="#" id="lineup">Lineup</a></li>\n		</ul>\n	')),d(b('\n\n	<ul id="login" class="nav navbar-nav navbar-right">\n		')),this.id?(d(b('\n  		<li class="avatar">\n    		')),d(this.name),d(b('\n    		<img src="https://graph.facebook.com/')),d(this.id),d(b('/picture?width=32&height=32" width="28" height="28"/>\n  		</li>\n  		<li><a href="#" class="logout">Logout</a></li>\n		'))):d(b('\n  		<li><a href="#" class="login">Login</a></li>\n		')),d(b("\n	</ul>\n</div>"))}.call(this),a.join("")}.call(function(){var c,d={escape:function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},safe:b};for(c in a)d[c]=a[c];return d}())},window.JST||(window.JST={}),window.JST["app/scripts/templates/passport"]=function(a){var b=function(a){"undefined"==typeof a&&null==a&&(a="");var b=new String(a);return b.ecoSafe=!0,b};return function(){var a=[],c=this,d=function(b){"undefined"!=typeof b&&null!=b&&a.push(b.ecoSafe?b:c.escape(b))};return function(){d(b('<div id="passport" class="panel">\n	<p>Your concert passport</p>\n</div>\n\n'))}.call(this),a.join("")}.call(function(){var c,d={escape:function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},safe:b};for(c in a)d[c]=a[c];return d}())},window.JST||(window.JST={}),window.JST["app/scripts/templates/welcome"]=function(a){var b=function(a){"undefined"==typeof a&&null==a&&(a="");var b=new String(a);return b.ecoSafe=!0,b};return function(){var a=[],c=this,d=function(b){"undefined"!=typeof b&&null!=b&&a.push(b.ecoSafe?b:c.escape(b))};return function(){d(b('<div id="welcome" class="panel">\n	<div class="festival-logo">\n	</div>\n		<h1 class="navbar-brand">Music Passport</h1>\n	<h2>Your bracelet is your digital music passport</h2>\n	<p>Check in at concerts, collect rewards and share it with friends</p>\n	<p>\n		<a href="#" class="btn btn-primary btn-large btn-login">Login with Facebook</a>\n	</p>\n</div>'))}.call(this),a.join("")}.call(function(){var c,d={escape:function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},safe:b};for(c in a)d[c]=a[c];return d}())},function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};musicPassport.Routers.AppRouter=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.routes={"":"welcome",":thngid/home":"home",":thngid":"start",lineup:"lineup"},d.prototype.initialize=function(){return this.carouselOptions={items:2,itemsTablet:[768,1],itemsMobile:[479,1],itemsScaleUp:!0,pagination:!1},this.welcomeView=new musicPassport.Views.Welcome({model:musicPassport.user}),$("#panel-carousel").owlCarousel(this.carouselOptions),this.owl=$(".owl-carousel").data("owlCarousel")},d.prototype.welcome=function(){var a,b;for(a=b=0;2>=b;a=++b)this.owl.removeItem();return this.owl.addItem(this.welcomeView.el)},d.prototype.home=function(){var a,b,c;if(musicPassport.user.isAuthenticated()){for(a=c=0;2>=c;a=++c)this.owl.removeItem();return b=new musicPassport.Views.Home({model:musicPassport.passport,owl:this.owl})}return this.navigate("",{trigger:!0})},d.prototype.start=function(a){return musicPassport.passport.set("thngid",a),musicPassport.user.isAuthenticated()?this.navigate(""+a+"/home",{trigger:!0}):this.welcome()},d.prototype.lineup=function(){},d}(Backbone.Router)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};musicPassport.Models.Profile=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.defaults={id:"",name:"",first_name:"",last_name:"",gender:"",username:"",link:"",locale:"",timezone:"",authenticated:!1},d.prototype.isAuthenticated=function(){return this.get("authenticated")},d}(Backbone.Model)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};musicPassport.Models.Passport=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.defaults={thngid:"!",exists:!1,own:!1,"new":!0},d.prototype.exists=function(){return this.get("exists")},d.prototype.isFromOwner=function(){return this.get("own")},d.prototype.isNew=function(){return this.get("new")},d}(Backbone.Model)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};musicPassport.Views.App=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/app"],d.prototype.el="body",d.prototype.events={"click .btn-login":"login"},d.prototype.initialize=function(){return this.on("login",this.login),this.on("logout",this.logout),this.render()},d.prototype.render=function(){return this.$el.append(this.template(this.model.toJSON())),new musicPassport.Views.Login({model:this.model,el:"#navigation"}),this},d.prototype.login=function(){return FB.login(null,{scope:"email,user_birthday"})},d.prototype.logout=function(a){return a.preventDefault(),FB.logout()},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};musicPassport.Views.Login=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/login"],d.prototype.events={"click .login":"login","click .logout":"logout","click .brand-logo, .passport":"home","click .lineup":"viewLineup"},d.prototype.initialize=function(){return this.model.on("change",this.render,this),this.render()},d.prototype.render=function(){return this.$el.html(this.template(this.model.toJSON())),this},d.prototype.login=function(a){return a.stopPropagation(),musicPassport.appView.trigger("login",a)},d.prototype.logout=function(){return musicPassport.appView.trigger("logout")},d.prototype.home=function(){var a;return a=musicPassport.passport.get("thngid"),musicPassport.router.navigate(""+a,{trigger:!0})},d.prototype.viewLineup=function(){return musicPassport.router.navigate("lineup",{trigger:!0})},d}(Backbone.View)}.call(this),function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};musicPassport.Views.Welcome=function(c){function e(){return this.showHideButtons=b(this.showHideButtons,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.tagName="div",e.prototype.className="panel-wrapper",e.prototype.template=JST["app/scripts/templates/welcome"],e.prototype.initialize=function(){return this.model.on("change",this.showHideButtons,this),this.render()},e.prototype.render=function(){return this.$el.html(this.template()),this.showHideButtons(),this},e.prototype.showHideButtons=function(){return this.model.get("id")?this.$(".btn-login").addClass("hidden"):this.$(".btn-login").removeClass("hidden")},e}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};musicPassport.Views.Home=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.tagName="div",d.prototype.className="panel-wrapper",d.prototype.template=JST["app/scripts/templates/home"],d.prototype.events={"click .btn-claim":"activate","click .checkin":"checkin","click .passport":"viewFullPassport"},d.prototype.initialize=function(a){var b,c=this;return this.owl=a.owl,b=a.model.get("thngid"),this.model.on("change",this.render,this),Evt.readThng({thng:b},function(){return Evt.readAction({type:"_activation"},function(a){return a.length?c.model.set({exists:!0,own:a[0].customFields.owner===musicPassport.user.get("id"),"new":a[0].thng!==b}):c.model.set("exists",!0)})},function(a){return 400===a.status?c.model.set("exists",!1):void 0})},d.prototype.render=function(){return this.$el.html(this.template(this.model.toJSON())),this.owl.addItem(this.el),this.model.exists()&&this.model.isFromOwner()&&!this.model.isNew()&&this.owl.addItem(new musicPassport.Views.Passport({model:this.model}).el),this},d.prototype.activate=function(a){var b,c=this;return a.preventDefault(),b={url:"/actions/_activation",data:{timestamp:(new Date).getTime(),type:"_activation",customFields:{owner:musicPassport.user.get("id")},thng:this.model.get("thngid")},method:"post",evrythngApiKey:Evt.options.evrythngApiKey},Evt.request(b,function(){return c.model.set("own",!0),c.model.set("new",!1)})},d.prototype.checkin=function(){return Evt.checkin({thng:this.model.get("thngid")},function(){})},d.prototype.viewFullPassport=function(a){return a.preventDefault(),this.owl.next(),$("body").animate({scrollTop:0})},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};musicPassport.Views.Passport=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.tagName="div",d.prototype.className="panel-wrapper",d.prototype.template=JST["app/scripts/templates/passport"],d.prototype.initialize=function(){return this.render()},d.prototype.render=function(){return this.$el.html(this.template()),this},d}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};musicPassport.Views.ErrorView=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=JST["app/scripts/templates/error.ejs"],d}(Backbone.View)}.call(this);